# プロダクト要求定義書

## 1. プロダクトビジョンと目的

### ビジョン
川崎市在住者が毎朝、その日の天気情報をLINEで手軽に受け取れるようにする。

### 目的
- 毎日の天気確認の手間を削減
- 出勤・外出前の準備に役立つ天気情報を自動配信
- 傘の持ち忘れなど、天気による不便を減らす

### ターゲットユーザー
- 川崎市在住者
- LINEを日常的に使用している人
- 毎朝天気を確認する習慣がある人

---

## 2. 主要な機能一覧

### 機能1: 天気情報の自動配信
- 毎日09:00に川崎市の天気情報をLINE配信
- 配信内容：最高気温、最低気温、降水確率（9時〜23時）

### 機能2: LINE友達管理
- LINE公式アカウントの友達全員に配信
- ブロックされたユーザーには自動的に配信停止

---

## 3. 成功の定義

### 定量的指標
- 毎日09:00±5分以内に配信成功率 99%以上
- メッセージ配信失敗率 1%以下
- API取得エラー率 5%以下

### 定性的指標
- ユーザーが毎朝安定してメッセージを受信できる
- メッセージ内容が読みやすく、必要な情報が一目で分かる

---

## 4. ビジネス要件

### コスト制約
- AWS利用料：月$5以下
- LINE Messaging API：無料枠内（月500通まで）
- OpenWeather API：無料枠内（1日1,000回まで）

### 運用要件
- メンテナンス頻度：月1回以下
- 障害対応：24時間以内に復旧
- ログ保持期間：7日間

---

## 5. ユーザーストーリー

### ストーリー1: 毎朝の天気確認
```
As a 川崎市在住者
I want 毎朝09:00にLINEで天気情報を受け取りたい
So that 朝の準備中に天気を確認する手間を省ける
```

### ストーリー2: 傘の持ち忘れ防止
```
As a 通勤・通学する人
I want 降水確率を知りたい
So that 傘を持っていくかどうか判断できる
```

### ストーリー3: 服装の調整
```
As a 外出する人
I want 最高気温と最低気温を知りたい
So that その日の服装を決められる
```

---

## 6. 受け入れ条件

### 機能要件の受け入れ条件
- [ ] 毎日09:00（JST）にメッセージが配信される
- [ ] メッセージに川崎市の最高気温、最低気温、降水確率が含まれる
- [ ] LINE友達全員に同じメッセージが配信される
- [ ] 天気API取得失敗時はエラーログが記録される
- [ ] LINE送信失敗時はエラーログが記録される

### 非機能要件の受け入れ条件
- [ ] 配信時刻の誤差が±5分以内
- [ ] メッセージが読みやすい形式で表示される
- [ ] CloudWatch Logsにログが記録される
- [ ] GitHub Actionsでデプロイが自動化される

---

## 7. 機能要件

### FR-1: 天気情報取得
- **説明**: OpenWeather APIから川崎市の天気情報を取得
- **入力**: なし（川崎市の座標は固定）
- **出力**: 最高気温、最低気温、降水確率
- **制約**: API呼び出しは1日1回のみ

### FR-2: メッセージ配信
- **説明**: LINE Broadcast APIで全友達にメッセージ配信
- **入力**: 天気情報（最高気温、最低気温、降水確率）
- **出力**: LINEメッセージ
- **制約**: LINE Messaging APIの無料枠内（月500通）

### FR-3: スケジュール実行
- **説明**: 毎日09:00（JST）にLambda関数を実行
- **入力**: EventBridgeスケジュールイベント
- **出力**: なし
- **制約**: EventBridgeのcron式はUTC時刻（00:00 UTC = 09:00 JST）

### FR-4: エラーハンドリング
- **説明**: 天気API取得失敗、LINE送信失敗時のエラーログ記録
- **入力**: エラー情報
- **出力**: CloudWatch Logsへのログ記録
- **制約**: エラー発生時もLambda関数は正常終了

---

## 8. 非機能要件

### NFR-1: パフォーマンス
- Lambda実行時間：30秒以内
- メッセージ配信完了時間：1分以内

### NFR-2: 可用性
- 配信成功率：99%以上
- API取得成功率：95%以上

### NFR-3: セキュリティ
- LINE Channel Access TokenをAWS Systems Manager Parameter Storeで管理
- OpenWeather API KeyをAWS Systems Manager Parameter Storeで管理
- Lambda関数にはIAMロールで最小権限を付与

### NFR-4: 保守性
- TypeScriptで型安全なコードを記述
- ユニットテストカバレッジ：80%以上
- コードはGitHubで管理

### NFR-5: 拡張性
- 将来的に他の都市への対応が可能な設計
- ユーザー個別設定（配信時刻、都市選択）への拡張を考慮

---

## 9. 除外事項（スコープ外）

以下は初回実装では対応しない：
- ユーザー個別の配信時刻設定
- 複数都市への対応
- ユーザーからのメッセージ受信（Webhook）
- 時間帯別の詳細な天気情報
- 天気アイコンや画像の送信
- プッシュ通知のカスタマイズ

---

## 10. リスクと対応策

### リスク1: OpenWeather API障害
- **対策**: エラーハンドリングとログ記録、翌日の配信で対応

### リスク2: LINE Messaging API障害
- **対策**: エラーハンドリングとログ記録、手動での再送信

### リスク3: AWS Lambda実行失敗
- **対策**: CloudWatch Alarmsで通知、手動での再実行

### リスク4: 無料枠超過
- **対策**: CloudWatch Metricsで使用量監視、月次での確認

---

## 11. 今後の拡張計画

### Phase 2（将来）
- ユーザー個別の都市設定
- 配信時刻のカスタマイズ
- Webhookによる双方向コミュニケーション

### Phase 3（将来）
- 天気アラート（大雨警報など）
- 週間天気予報の配信
- 天気画像・アイコンの送信
